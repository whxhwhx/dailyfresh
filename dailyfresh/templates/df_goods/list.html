{%extends 'df_goods/de_li_base.html'%}
{%block innermost%}
	<div class="breadcrumb">
		<a href="#">全部分类</a>
		<span>></span>
		<a href="#">新鲜水果</a>
	</div>

	<div class="main_wrap clearfix">
		<div class="l_wrap fl clearfix">
			<div class="new_goods">
				<h3>新品推荐</h3>
				<ul>
                    {%for g in news%}
					<li>
						<a href="/{{g.id}}/"><img src="/static/{{g.gpic}}"></a>
						<h4><a href="/{{g.id}}/">{{g.gtitle}}</a></h4>
						<div class="prize">￥{{g.gprice}}</div>
					</li>
					{%endfor%}

				</ul>
			</div>
		</div>

		<div class="r_wrap fr clearfix">
			<div class="sort_bar">
				<a href="/list/{{goodtype.id}}_1_1/"
				   {%if sort == "1" %}
				   class="active"
				   {%endif%}
				>默认</a>

				<a href="/list/{{goodtype.id}}_1_2/"
				   {%if sort == "2" %}
				   class="active"
				   {%endif%}
				>价格</a>
				<a href="/list/{{goodtype.id}}_1_3/"
				   {%if sort == "3" %}
				   class="active"
				   {%endif%}
				>人气</a>
			</div>

			<ul class="goods_type_list clearfix">
				{%for g in page%}

				<li>
					<a href="/{{g.id}}/"><img src="/static/{{g.gpic}}"></a>
					<h4><a href="/{{g.id}}/">{{g.gtitle}}</a></h4>
					<div class="operate">
						<span class="prize">￥{{g.gprice}}</span>
						<span class="unit">{{g.gprice}}/{{g.gunit}}</span>
						<a href="javascript:;" name="{{g.id}}" class="add_goods" title="加入购物车"></a>
					</div>
				</li>
				{%endfor%}


			</ul>

			<div class="pagenation">
				{%if page.has_previous%}
				<a href="/list/{{goodtype.id}}_{{page.previous_page_number}}_{{sort}}">上一页</a>
				{%endif%}

                {%for pindex in paginator.page_range%}
				{%if pindex == page.number%}
				<a href="#" class="active">{{pindex}}</a>
				{%else%}
				<a href="/list/{{goodtype.id}}_{{pindex}}_{{sort}}/">{{pindex}}</a>
				{%endif%}
				{%endfor%}

				{%if page.has_next%}
				<a href="/list/{{goodtype.id}}_{{page.next_page_number}}_{{sort}}/">下一页</a>
				{%endif%}
			</div>
		</div>
		<div class="add_jump"></div>
	</div>

{%endblock innermost%}

{%block tail%}


		var $to_x = $('#show_count').offset().top;
		var $to_y = $('#show_count').offset().left;

		// 因为每个li给服务器发送的内容都不一样，直接选择器不行，用each循环给 add_goods 绑定事件
		$('.add_goods').each(function(){
			$(this).click(function(){

				// 这里也是因为每个图标位置不一样，所以获取的时候只能放在循环里面，用this
				var $add_x = $(this).offset().top;
				var $add_y = $(this).offset().left;
				$(".add_jump").css({'left':$add_y,'top':$add_x,'display':'block'})

				// ajax的局部更新并不会使装饰器生效，本地判断一下
				if($('.login_btn').text().indexOf('登录')>=0){
					alert('请先登录');
					location.href = '/user/login/'
					return;
				}

				//动画部分
				$(".add_jump").stop().animate({
					'left': $to_y+7,
					'top': $to_x+7},
					"fast", function() {
						$(".add_jump").fadeOut('fast',function(){});

				});

				//ajax部分
				id = $(this).prop('name');
				$.get('/cart/add'+id+'_1/', function(data){
					$('#show_count').text(data.count);
				});

			});
		});




{%endblock tail%}
